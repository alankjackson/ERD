---
title: "Read FEMA Flood Data"
author: "Alan Jackson"
format: html
editor: source
---

##        Read a Parquet file downloaded from FEMA

https://www.fema.gov/openfema-data-page/fima-nfip-redacted-claims-v2




```{r setup}

library(tidyverse)

pq_path <- "/home/ajackson/Dropbox/Rprojects/ERD/Data/"


```

##        Set up connection to file and pull out Harris county

```{r}
FEMA <- arrow::open_dataset(paste0(pq_path,"FimaNfipClaims.parquet"))

FEMA_Harris <- FEMA %>% 
  filter(countyCode=="48201") %>% 
  collect()

saveRDS(FEMA_Harris, paste0(pq_path, "FEMA_Harris_Flood.rds"))

```

##        Look at data

```{r}

foobar <- FEMA_Harris %>%
  filter(censusTract=="48201343700") %>% 
  select(dateOfLoss, ratedFloodZone, occupancyType, amountPaidOnBuildingClaim,
         yearOfLoss, buildingDamageAmount, buildingPropertyValue,
         buildingReplacementCost, causeOfDamage, floodEvent, waterDepth,
         floodZoneCurrent, censusTract, censusBlockGroupFips,
         nfipCommunityName) %>% 
  filter(occupancyType %in% c(1,2,3,11,12,13,14,15))

###   occupancy types
# 1=single family residence; 
# 2 = 2 to 4 unit residential building; 
# 3 = residential building with more than 4 units; 
# 4 = Non-residential building; 
# 6 = Non Residential - Business; 
# 11 = Single-family residential building with the exception of a mobile home or a single residential unit within a multi unit building; 
# 12 = A residential non-condo building with 2, 3, or 4 units seeking insurance on all units; 
# 13 = A residential non-condo building with 5 or more units seeking insurance on all units; 
# 14 = Residential mobile/manufactured home; 
# 15 = Residential condo association seeking coverage on a building with one or more units; 
# 16 = Single residential unit within a multi-unit building; 
# 17 = Non-residential mobile/manufactured home; 
# 18 = A non-residential building; 
# 19 = a non-residential unit within a multi-unit building;

```






